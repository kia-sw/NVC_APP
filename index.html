<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVC Konfliktl√∂sare</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Icons
        const Heart = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
        );

        const ArrowRight = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
        );

        const ArrowLeft = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        );

        const AlertCircle = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const CheckCircle2 = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
                <path d="m9 12 2 2 4-4"></path>
            </svg>
        );

        const Lightbulb = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path>
                <path d="M9 18h6"></path>
                <path d="M10 22h4"></path>
            </svg>
        );

        const MessageCircle = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
            </svg>
        );

        const Users = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const NVCApp = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [responses, setResponses] = useState({
                conflict: '',
                observation: '',
                feelings: '',
                needs: '',
                request: '',
                empathy: ''
            });
            const [feedback, setFeedback] = useState(null);
            const [analysis, setAnalysis] = useState(null);

            const analyzeObservation = (text) => {
                const judgmentWords = ['alltid', 'aldrig', 'borde', 'm√•ste', 'fel', 'r√§tt', 'd√•lig', 'bra', 'lat', 'oansvarig', 'inkompetent', 'elak', 'dum'];
                const interpretationWords = ['vill inte', 'bryr sig inte', 'avsiktligt', 'medvetet', 'f√∂rs√∂ker', 'menar att'];
                
                const foundJudgments = judgmentWords.filter(word => text.toLowerCase().includes(word));
                const foundInterpretations = interpretationWords.filter(word => text.toLowerCase().includes(word));
                
                if (foundJudgments.length > 0 || foundInterpretations.length > 0) {
                    return {
                        type: 'warning',
                        message: 'Jag m√§rker n√•gra v√§rdeladdade ord i din observation:',
                        issues: [
                            ...foundJudgments.map(w => `"${w}" √§r en v√§rdering`),
                            ...foundInterpretations.map(w => `"${w}" √§r en tolkning av avsikt`)
                        ],
                        suggestion: 'F√∂rs√∂k beskriva bara vad du s√•g eller h√∂rde.',
                        phrases: ['Jag s√•g/h√∂rde att...', 'N√§r X h√§nde...']
                    };
                }
                
                return {
                    type: 'success',
                    message: 'Bra! Din observation √§r objektiv och konkret.',
                    suggestion: 'Du beskriver fakta utan v√§rderingar.',
                    phrases: []
                };
            };

            const analyzeFeelings = (text) => {
                const pseudoFeelings = ['att du', 'att han', 'att hon', 'att de', 'ignorerad', 'f√∂rr√•dd', 'attackerad', 'missf√∂rst√•dd'];
                const genuineFeelings = ['glad', 'ledsen', 'r√§dd', 'arg', 'frustrerad', 'besviken', 'orolig', 'nerv√∂s', 'stressad'];
                
                const foundPseudo = pseudoFeelings.filter(word => text.toLowerCase().includes(word));
                const foundGenuine = genuineFeelings.filter(word => text.toLowerCase().includes(word));
                
                if (foundPseudo.length > 0) {
                    return {
                        type: 'warning',
                        message: 'Jag ser att du blandar k√§nslor med tankar:',
                        issues: foundPseudo.map(w => `"${w}" √§r en tanke/tolkning`),
                        suggestion: 'Fokusera p√• vad DU k√§nner.',
                        phrases: ['Jag k√§nner mig ledsen n√§r...', 'Jag k√§nner mig frustrerad...']
                    };
                }
                
                if (foundGenuine.length > 0) {
                    return {
                        type: 'success',
                        message: 'Utm√§rkt! Du uttrycker genuina k√§nslor.',
                        suggestion: 'Dessa k√§nslor pekar p√• viktiga behov.',
                        phrases: []
                    };
                }
                
                return {
                    type: 'info',
                    message: 'F√∂rs√∂k identifiera dina k√§nslor mer specifikt.',
                    suggestion: 'Vanliga k√§nslor: glad, ledsen, r√§dd, arg, frustrerad, besviken.',
                    phrases: ['N√§r jag t√§nker p√• detta k√§nner jag mig...']
                };
            };

            const analyzeNeeds = (text) => {
                const strategies = ['att han', 'att hon', 'att du', 'att de', 'skulle', 'm√•ste'];
                const universalNeeds = ['respekt', 'f√∂rst√•else', 'trygghet', 'autonomi', 'samh√∂righet', 'st√∂d', 'uppskattning', 'klarhet'];
                
                const foundStrategies = strategies.filter(word => text.toLowerCase().includes(word));
                const foundNeeds = universalNeeds.filter(word => text.toLowerCase().includes(word));
                
                if (foundStrategies.length > 0) {
                    return {
                        type: 'warning',
                        message: 'Du beskriver en strategi snarare √§n ett behov:',
                        issues: foundStrategies.map(w => `"${w}" indikerar ett krav`),
                        suggestion: 'Fr√•ga dig: Vad s√∂ker jag egentligen?',
                        phrases: ['Jag har behov av respekt...', 'Jag l√§ngtar efter f√∂rst√•else...']
                    };
                }
                
                if (foundNeeds.length > 0) {
                    return {
                        type: 'success',
                        message: 'Mycket bra! Du har identifierat universella behov.',
                        suggestion: `Behovet av ${foundNeeds[0]} √§r n√•got alla kan relatera till.`,
                        phrases: []
                    };
                }
                
                return {
                    type: 'info',
                    message: 'F√∂rs√∂k identifiera det underliggande behovet.',
                    suggestion: 'Vanliga behov: respekt, f√∂rst√•else, trygghet, autonomi, samh√∂righet.',
                    phrases: ['Mitt behov av ... √§r inte uppfyllt']
                };
            };

            const analyzeRequest = (text) => {
                const negative = ['inte', 'sluta', 'undvik', 'l√•t bli'];
                const vague = ['mer', 'b√§ttre', 'mindre', 'oftare'];
                
                const hasNegative = negative.some(word => text.toLowerCase().includes(word));
                const hasVague = vague.some(word => text.toLowerCase().includes(word));
                
                if (hasNegative) {
                    return {
                        type: 'warning',
                        message: 'Din beg√§ran √§r formulerad negativt:',
                        issues: ['Formulera vad du VILL ist√§llet'],
                        suggestion: 'Vad vill du att personen G√ñR?',
                        phrases: ['Skulle du kunna... ?', 'Vore du villig att... ?']
                    };
                }
                
                if (hasVague) {
                    return {
                        type: 'warning',
                        message: 'Din beg√§ran √§r lite vag:',
                        issues: ['Var specifik: VEM, VAD, N√ÑR?'],
                        suggestion: 'Exempel: "Kan du informera mig senast kl 15 dagen f√∂re?"',
                        phrases: []
                    };
                }
                
                return {
                    type: 'success',
                    message: 'Din beg√§ran √§r konkret och genomf√∂rbar!',
                    suggestion: 'Kom ih√•g: En beg√§ran √§r inte ett krav.',
                    phrases: []
                };
            };

            const generatePersonalizedAnalysis = () => {
                const { conflict, observation, feelings, needs, request, empathy } = responses;
                
                // Analysera konflikttyp
                const isWork = /kollega|chef|arbete|m√∂te|projekt|kontor/i.test(conflict);
                const isFamily = /familj|mamma|pappa|syster|bror|barn|f√∂r√§lder/i.test(conflict);
                const isPartner = /partner|pojkv√§n|flickv√§n|sambo|man|fru/i.test(conflict);
                const isRecurring = /alltid|igen|tredje|fj√§rde|flera|varje|st√§ndigt/i.test(conflict);
                const isTense = /arg|frustrerad|irriterad|uppr√∂rd|f√∂rbannad/i.test(feelings.toLowerCase());
                
                // Identifiera person
                let personType = 'personen';
                if (isWork) personType = conflict.match(/kollega|chef/i) ? conflict.match(/kollega|chef/i)[0].toLowerCase() : 'kollegan';
                if (isFamily) personType = 'din familjemedlem';
                if (isPartner) personType = 'din partner';

                // NVC-analys
                const judgmentWords = ['alltid', 'aldrig', 'borde', 'm√•ste', 'lat', 'oansvarig'];
                const hasJudgments = judgmentWords.some(w => observation.toLowerCase().includes(w));
                
                let nvcAnalys = `Jag ser att du beskriver situationen: "${observation}". `;
                
                if (hasJudgments) {
                    nvcAnalys += `I denna formulering finns n√•gra v√§rdeladdade ord som kan f√• ${personType} att bli defensiv. `;
                } else {
                    nvcAnalys += `Detta √§r en bra objektiv observation. `;
                }
                
                nvcAnalys += `Dina k√§nslor (${feelings}) pekar tydligt p√• att dina behov av ${needs} inte √§r uppfyllda. `;
                
                if (isRecurring) {
                    nvcAnalys += `Eftersom detta har h√§nt flera g√•nger √§r det viktigt att ni hittar en h√•llbar l√∂sning tillsammans, inte bara l√∂ser den akuta situationen.`;
                } else {
                    nvcAnalys += `Din beg√§ran √§r konkret vilket g√∂r det l√§ttare f√∂r ${personType} att f√∂rst√• vad du beh√∂ver.`;
                }

                // F√∂rb√§ttrad formulering
                const cleanObs = observation.replace(/alltid|aldrig|borde|m√•ste|lat|oansvarig|inkompetent/gi, '').trim() || observation;
                const forbattradFormulering = `"N√§r ${cleanObs.toLowerCase()}, k√§nner jag mig ${feelings.toLowerCase()}, eftersom jag har behov av ${needs.toLowerCase()}. ${request}"`;

                // Dialogexempel med DERAS ord
                const dialogexempel = `SCENARIO 1 - ${personType.charAt(0).toUpperCase() + personType.slice(1)} √§r √∂ppen f√∂r samtal:

Du: "Hej, jag skulle vilja prata med dig om n√•got viktigt. Har du 15 minuter?"

${personType.charAt(0).toUpperCase() + personType.slice(1)}: "Ja visst, vad g√§ller det?"

Du: "N√§r ${cleanObs.toLowerCase()}, k√§nner jag mig ${feelings.toLowerCase()}, eftersom jag har behov av ${needs.toLowerCase()}. ${request}"

${personType.charAt(0).toUpperCase() + personType.slice(1)}: "Okej, jag f√∂rst√•r. Jag visste inte att du k√§nde s√•."

Du: "Tack f√∂r att du lyssnar. Jag √§r nyfiken - hur upplever du sj√§lv situationen?"

${personType.charAt(0).toUpperCase() + personType.slice(1)}: [Delar sitt perspektiv]

Du: "S√• om jag f√∂rst√•r dig r√§tt, k√§nner du dig ${empathy.toLowerCase().includes('stress') ? 'stressad och √∂verbelastad' : 'pressad'}, och har behov av ${empathy.toLowerCase().includes('balans') ? 'balans och avlastning' : 'mer tid eller st√∂d'}?"

${personType.charAt(0).toUpperCase() + personType.slice(1)}: "Ja, exakt."

Du: "Hur kan vi l√∂sa detta tillsammans s√• att b√•de ditt behov och mitt behov blir tillgodosedda?"

---

SCENARIO 2 - Om ${personType} blir defensiv:

${personType.charAt(0).toUpperCase() + personType.slice(1)}: "Men jag hade ju s√• mycket att g√∂ra! Du f√∂rst√•r inte..."

Du: [PAUSA - andas lugnt] "Jag h√∂r att du k√§nner dig pressad och kanske lite frustrerad √∂ver att jag tar upp det h√§r. St√§mmer det?"

${personType.charAt(0).toUpperCase() + personType.slice(1)}: "Ja! Jag g√∂r mitt b√§sta!"

Du: "Jag tror dig. Mitt behov av ${needs.toLowerCase()} handlar inte om att kritisera dig - det handlar om hur vi kan samarbeta s√• att det fungerar f√∂r oss b√•da. Kan vi prata om det?"

${personType.charAt(0).toUpperCase() + personType.slice(1)}: [Lugnar ner sig] "Okej... vad f√∂resl√•r du?"

Du: "${request} Skulle det fungera f√∂r dig?"`;

                // Konkreta steg
                const konkretaSteg = [
                    `F√∂rbered dig: Skriv ner din NVC-formulering p√• papper. √ñva h√∂gt: "${forbattradFormulering}". G√∂r 5 djupa andetag innan samtalet.`,
                    
                    isWork 
                        ? `V√§lj r√§tt tidpunkt: Boka in ett m√∂te eller fr√•ga: "Har du 15 minuter f√∂r ett viktigt samtal?" Undvik att ta upp det i korridoren eller n√§r n√•gon √§r stressad.`
                        : `V√§lj r√§tt tidpunkt: Fr√•ga n√§r ni b√•da √§r lugna och har tid. "Kan vi prata om n√•got viktigt? N√§r passar det b√§st f√∂r dig?"`,
                    
                    `Inled samtalet: B√∂rja med din observation utan anklagelser. "N√§r ${cleanObs.toLowerCase()}..." Pausa och ge ${personType} tid att ta in det du s√§ger.`,
                    
                    `Dela k√§nslor och behov: "${feelings}" + "eftersom jag beh√∂ver ${needs}". Var s√•rbar och √§rlig. Detta √§r nyckeln till att skapa f√∂rst√•else.`,
                    
                    `St√§ll din beg√§ran: "${request}" Fr√•ga sedan: "Vad t√§nker du om det?" Detta visar att det √§r en beg√§ran, inte ett krav.`,
                    
                    isTense 
                        ? `Om ${personType} blir defensiv: Ge INTE tillbaka! Ist√§llet: "Jag h√∂r att du k√§nner dig [gissa k√§nsla]. Kan du ber√§tta mer?" Lyssna utan att f√∂rsvara dig.`
                        : `Lyssna empatiskt: N√§r ${personType} pratar, reflektera tillbaka: "L√•ter det som att du k√§nner... eftersom du beh√∂ver...?" Forts√§tt tills de s√§ger "Ja, precis!"`,
                    
                    `Gemensam l√∂sning: "Hur kan vi l√∂sa detta s√• att b√•de ditt behov av ${empathy.toLowerCase().includes('balans') ? 'balans' : empathy.toLowerCase().includes('tid') ? 'tid' : '[deras behov]'} och mitt behov av ${needs.toLowerCase()} blir tillgodosedda?" Brainstorma tillsammans.`,
                    
                    isRecurring
                        ? `F√∂lj upp: Eftersom detta h√§nt flera g√•nger - boka ett uppf√∂ljningsm√∂te om en vecka. "Ska vi ses n√§sta vecka och se hur det fungerar?" Detta visar l√•ngsiktigt engagemang.`
                        : `F√∂lj upp: Boka direkt en uppf√∂ljning om 1-2 veckor. "Ska vi kolla hur det fungerar d√•?" Skriv ner vad ni kommit √∂verens om.`
                ];

                // Empatitips
                const empatitips = `N√§r ${personType} pratar om sin upplevelse:

STEG 1 - Ge full n√§rvaro
L√§gg bort telefonen. Sitt ner. Andas. Din enda uppgift just nu √§r att F√ñRST√Ö ${personType}s perspektiv.

STEG 2 - Lyssna f√∂r k√§nslor och behov
Du skrev att du tror ${personType} k√§nner: "${empathy}". 
Lyssna aktivt f√∂r att bekr√§fta eller uppt√§cka vad som verkligen h√§nder f√∂r dem.

STEG 3 - Reflektera tillbaka
"L√•ter det som att du k√§nner dig ${empathy.toLowerCase().includes('stress') ? 'stressad och √∂verbelastad' : 'pressad'}, eftersom du beh√∂ver ${empathy.toLowerCase().includes('balans') ? 'balans mellan arbete och privatliv' : empathy.toLowerCase().includes('tid') ? 'mer tid' : 'st√∂d och f√∂rst√•else'}?"

V√§nta p√• svar. Om de s√§ger "Nej", fr√•ga: "Hj√§lp mig f√∂rst√• - vad k√§nner du?"

STEG 4 - F√∂rdjupa
"Kan du ber√§tta mer om det?"
"Vad √§r det i situationen som k√§nns viktigast f√∂r dig?"
"Hur l√§nge har du k√§nt s√• h√§r?"

STEG 5 - H√•ll utrymmet
Motst√• frestelsen att f√∂rklara dig, r√§tta dem eller f√∂rsvara dig. Bara LYSSNA. ${isTense ? 'S√§rskilt viktigt eftersom k√§nslorna √§r starka h√§r.' : ''}

Tecken p√• att det fungerar:
‚Ä¢ ${personType.charAt(0).toUpperCase() + personType.slice(1)} s√§ger "Exakt!" eller "Ja, precis s√•!"
‚Ä¢ Deras kroppsspr√•k mjuknar
‚Ä¢ De b√∂rjar prata mer √∂ppet och djupare`;

                // Varningar
                let varningar = `UNDVIK I DENNA SITUATION:

${hasJudgments ? '‚ùå V√§rdeladdade ord: Ord som "alltid", "aldrig", "borde", "lat" f√•r personen att st√§nga av. H√•ll dig till faktiska observationer.' : ''}

${isRecurring ? `‚ùå "Du G√ñR ju alltid detta!" - √Ñven om det h√§nt m√•nga g√•nger, fokusera p√• DEN SPECIFIKA h√§ndelsen f√∂rst. N√§r tillit byggts kan ni prata om m√∂nstret.` : ''}

${isTense ? `‚ùå Att attackera tillbaka: Om ${personType} blir arg - bli INTE arg tillbaka. Andas. "Jag m√§rker att k√§nslorna √§r starka nu. Ska vi ta en paus?"` : ''}

${isWork ? `‚ùå Att ta upp det offentligt: Detta √§r ett k√§nsligt samtal. G√∂r det privat, inte framf√∂r andra kollegor.` : ''}

${isPartner ? `‚ùå Att dra upp gamla saker: H√•ll dig till DENNA situation. "Du gjorde samma sak f√∂rra √•ret!" hj√§lper inte.` : ''}

‚ùå "Jag k√§nner att du inte bryr dig" - Detta √§r INTE en k√§nsla, det √§r en bed√∂mning. K√§nslor: ledsen, frustrerad, besviken.

‚ùå Ultimatum: "${request}" √§r en beg√§ran, inte ett krav. Var beredd att lyssna p√• ${personType}s perspektiv och hitta en l√∂sning tillsammans.

KRITISKT: Om ${personType} blir mycket uppr√∂rd eller samtalet blir destruktivt - PAUSA. "Jag m√§rker att det h√§r √§r sv√•rt just nu. Ska vi forts√§tta i morgon n√§r vi b√•da k√§nner oss lugnare?" Det √§r okej att ta en paus.`;

                return {
                    nvc_analys: nvcAnalys,
                    f√∂rb√§ttrad_formulering: forbattradFormulering,
                    dialogexempel: dialogexempel,
                    konkreta_steg: konkretaSteg,
                    empatitips: empatitips,
                    varningar: varningar
                };
            };

            const steps = [
                {
                    id: 'conflict',
                    title: 'Beskriv situationen',
                    question: 'Vad har h√§nt? Beskriv konflikten eller problemet:',
                    placeholder: 'Exempel: Min kollega kom inte till m√∂tet ig√•r och jag fick ta hela presentationen sj√§lv...',
                    help: 'Skriv fritt h√§r. Vi g√•r igenom NVC-stegen tillsammans.'
                },
                {
                    id: 'observation',
                    title: '1. Observation',
                    question: 'Vad h√§nde konkret? Beskriv bara vad du s√•g eller h√∂rde:',
                    placeholder: 'Exempel: Min kollega var inte p√• m√∂tet kl 14:00 ig√•r.',
                    help: 'T√§nk som en videokamera: Vad skulle den spela in?',
                    analyze: analyzeObservation
                },
                {
                    id: 'feelings',
                    title: '2. K√§nslor',
                    question: 'Vilka k√§nslor v√§cks i dig?',
                    placeholder: 'Exempel: Jag k√§nner mig frustrerad, besviken och √∂vergiven.',
                    help: 'Undvik "jag k√§nner att du..." - fokusera p√• vad DU k√§nner.',
                    analyze: analyzeFeelings
                },
                {
                    id: 'needs',
                    title: '3. Behov',
                    question: 'Vilket behov hos dig √§r inte uppfyllt?',
                    placeholder: 'Exempel: Jag har behov av samarbete, p√•litlighet och st√∂d.',
                    help: 'Behov √§r universella - n√•got alla m√§nniskor har.',
                    analyze: analyzeNeeds
                },
                {
                    id: 'request',
                    title: '4. Beg√§ran',
                    question: 'Vad vill du konkret att den andra personen g√∂r?',
                    placeholder: 'Exempel: Skulle du kunna meddela mig minst 24 timmar i f√∂rv√§g n√§sta g√•ng?',
                    help: 'Var specifik och positiv (vad du VILL).',
                    analyze: analyzeRequest
                },
                {
                    id: 'empathy',
                    title: '5. Empati',
                    question: 'Vilka k√§nslor och behov tror du den andra personen har?',
                    placeholder: 'Exempel: Kanske k√§nner sig min kollega stressad och har behov av balans.',
                    help: 'Gissa den andras perspektiv - detta f√∂rbereder dig.'
                }
            ];

            const handleInputChange = (value) => {
                const stepId = steps[currentStep].id;
                setResponses(prev => ({ ...prev, [stepId]: value }));
                
                if (steps[currentStep].analyze && value.length > 20) {
                    const result = steps[currentStep].analyze(value);
                    setFeedback(result);
                } else {
                    setFeedback(null);
                }
            };

            const nextStep = () => {
                if (currentStep < steps.length - 1) {
                    setCurrentStep(currentStep + 1);
                    setFeedback(null);
                } else {
                    const personalAnalysis = generatePersonalizedAnalysis();
                    setAnalysis(personalAnalysis);
                }
            };

            const prevStep = () => {
                if (currentStep > 0) {
                    setCurrentStep(currentStep - 1);
                    setFeedback(null);
                }
            };

            const reset = () => {
                setCurrentStep(0);
                setResponses({
                    conflict: '',
                    observation: '',
                    feelings: '',
                    needs: '',
                    request: '',
                    empathy: ''
                });
                setFeedback(null);
                setAnalysis(null);
            };

            const currentStepData = steps[currentStep];
            const currentValue = responses[currentStepData.id];
            const progress = ((currentStep + 1) / steps.length) * 100;

            if (analysis) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-4 md:p-6">
                        <div className="max-w-4xl mx-auto space-y-6">
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-8 h-8 text-rose-500"><Heart /></div>
                                    <h1 className="text-2xl md:text-3xl font-bold text-gray-800">Din personliga NVC-l√∂sning</h1>
                                </div>
                                <p className="text-gray-600">Baserad p√• din specifika situation</p>
                            </div>

                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">üìä Analys av din situation</h2>
                                <p className="text-gray-700 leading-relaxed">{analysis.nvc_analys}</p>
                            </div>

                            <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl shadow-xl p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">‚ú® S√• h√§r kan du s√§ga det</h2>
                                <p className="text-gray-700 text-lg leading-relaxed italic">{analysis.f√∂rb√§ttrad_formulering}</p>
                            </div>

                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <div className="w-6 h-6 text-purple-600"><MessageCircle /></div>
                                    Dialogexempel f√∂r din situation
                                </h2>
                                <div className="bg-gray-50 rounded-lg p-4">
                                    <p className="text-gray-700 whitespace-pre-line leading-relaxed">{analysis.dialogexempel}</p>
                                </div>
                            </div>

                            <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl shadow-xl p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <div className="w-6 h-6 text-green-600"><CheckCircle2 /></div>
                                    Steg-f√∂r-steg: Vad du ska g√∂ra
                                </h2>
                                <ol className="space-y-3">
                                    {analysis.konkreta_steg.map((step, index) => (
                                        <li key={index} className="flex items-start gap-3">
                                            <span className="flex-shrink-0 w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center font-bold text-sm">
                                                {index + 1}
                                            </span>
                                            <span className="text-gray-700 pt-1">{step}</span>
                                        </li>
                                    ))}
                                </ol>
                            </div>

                            <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl shadow-xl p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <div className="w-6 h-6 text-blue-600"><Users /></div>
                                    Hur du lyssnar empatiskt
                                </h2>
                                <p className="text-gray-700 whitespace-pre-line leading-relaxed">{analysis.empatitips}</p>
                            </div>

                            <div className="bg-red-50 border-l-4 border-red-400 rounded-r-lg p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <span className="text-2xl">‚ö†Ô∏è</span> Undvik detta
                                </h2>
                                <p className="text-gray-700 whitespace-pre-line">{analysis.varningar}</p>
                            </div>

                            <div className="text-center pb-6">
                                <button
                                    onClick={reset}
                                    className="px-8 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-all"
                                >
                                    Analysera en ny konflikt
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-4 md:p-6">
                    <div className="max-w-3xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-6">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-8 h-8 text-rose-500"><Heart /></div>
                                <h1 className="text-2xl md:text-3xl font-bold text-gray-800">NVC Konfliktl√∂sare</h1>
                            </div>
                            
                            <div className="mb-6">
                                <div className="flex justify-between text-sm text-gray-600 mb-2">
                                    <span>Steg {currentStep + 1} av {steps.length}</span>
                                    <span>{Math.round(progress)}%</span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-2">
                                    <div 
                                        className="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-300"
                                        style={{ width: `${progress}%` }}
                                    />
                                </div>
                            </div>

                            <h2 className="text-xl md:text-2xl font-bold text-purple-600 mb-4">
                                {currentStepData.title}
                            </h2>

                            <div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                                <p className="text-gray-700 font-medium">{currentStepData.question}</p>
                            </div>

                            <textarea
                                value={currentValue}
                                onChange={(e) => handleInputChange(e.target.value)}
                                placeholder={currentStepData.placeholder}
                                className="w-full h-32 p-4 border-2 border-gray-200 rounded-lg focus:border-purple-400 focus:outline-none resize-none mb-4"
                            />

                            <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                                <div className="flex items-start gap-2">
                                    <div className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"><Lightbulb /></div>
                                    <p className="text-sm text-gray-700">{currentStepData.help}</p>
                                </div>
                            </div>

                            {feedback && (
                                <div className={`border-l-4 p-4 mb-6 rounded-r-lg ${
                                    feedback.type === 'success' ? 'bg-green-50 border-green-400' :
                                    feedback.type === 'warning' ? 'bg-orange-50 border-orange-400' :
                                    'bg-blue-50 border-blue-400'
                                }`}>
                                    <div className="flex items-start gap-2 mb-3">
                                        <div className={`w-5 h-5 flex-shrink-0 mt-0.5 ${
                                            feedback.type === 'success' ? 'text-green-600' : 'text-orange-600'
                                        }`}>
                                            {feedback.type === 'success' ? <CheckCircle2 /> : <AlertCircle />}
                                        </div>
                                        <p className="font-semibold text-gray-800">{feedback.message}</p>
                                    </div>
                                    
                                    {feedback.issues && feedback.issues.length > 0 && (
                                        <ul className="ml-7 mb-3 space-y-1">
                                            {feedback.issues.map((issue, i) => (
                                                <li key={i} className="text-sm text-gray-700">‚Ä¢ {issue}</li>
                                            ))}
                                        </ul>
                                    )}

                                    <p className="text-sm text-gray-700 mb-3 ml-7">{feedback.suggestion}</p>

                                    {feedback.phrases && feedback.phrases.length > 0 && (
                                        <div className="ml-7 bg-white bg-opacity-50 rounded-lg p-3">
                                            <p className="text-xs font-semibold text-gray-600 mb-2">üí¨ NVC-fraser:</p>
                                            {feedback.phrases.map((phrase, i) => (
                                                <p key={i} className="text-sm text-gray-700 italic mb-1">"{phrase}"</p>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            <div className="flex gap-3">
                                <button
                                    onClick={prevStep}
                                    disabled={currentStep === 0}
                                    className="flex items-center gap-2 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                >
                                    <div className="w-5 h-5"><ArrowLeft /></div>
                                    F√∂reg√•ende
                                </button>

                                <button
                                    onClick={nextStep}
                                    disabled={!currentValue.trim()}
                                    className="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                >
                                    {currentStep === steps.length - 1 ? 'F√• din l√∂sning' : 'N√§sta steg'}
                                    <div className="w-5 h-5"><ArrowRight /></div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<NVCApp />, document.getElementById('root'));
    </script>
</body>
</html>
